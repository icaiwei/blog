(window.webpackJsonp=window.webpackJsonp||[]).push([[248],{2924:function(s,n,a){"use strict";a.r(n);var t=a(0),l=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"动态库的特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动态库的特点"}},[s._v("#")]),s._v(" 动态库的特点")]),s._v(" "),n("h3",{attrs:{id:"特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[s._v("#")]),s._v(" 特点")]),s._v(" "),n("ol",[n("li",[s._v("运行时独立存在")]),s._v(" "),n("li",[s._v("源码不会链接到执行程序")]),s._v(" "),n("li",[s._v("使用时加载（使用动态库必须是动态库执行）")])]),s._v(" "),n("h3",{attrs:{id:"与静态库比较"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#与静态库比较"}},[s._v("#")]),s._v(" 与静态库比较")]),s._v(" "),n("ol",[n("li",[s._v("由于静态库是将代码嵌入到使用程序中，多个程序时使用时，会有多份代码，所以代码体积会增大。动态库的代码只需要存在一份，其他程序通过函数地址使用，所以代码体积小。")]),s._v(" "),n("li",[s._v("静态库发生变化后，新的代码需要重新链接嵌入到执行程序中。动态库发生变化后，如果库中函数的定义（或地址）未变化，其它使用DLL的程序不需重新链接。")])]),s._v(" "),n("h3",{attrs:{id:"动态库的创建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动态库的创建"}},[s._v("#")]),s._v(" 动态库的创建")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("创建动态库项目")])]),s._v(" "),n("li",[n("p",[s._v("添加库程序")])]),s._v(" "),n("li",[n("p",[s._v("库程序导出-提供给使用者库中的函数等信息。")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("声明导出：使用_declspec(dllexport)导出函数")]),s._v(" "),n("p",[s._v("注意：动态库编译连接后，也会有LIB文件，是作为动态库函数映射使用，与静态库不完全相同。")])]),s._v(" "),n("li",[n("p",[s._v("模块定义文件.def")]),s._v(" "),n("p",[s._v("例如：")]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LIBRARY DLLFunc\t//库\nEXPORTS\t\t\t//库导出表\nDLL_Mul @1\t\t//导出的函数\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])])])])]),s._v(" "),n("h2",{attrs:{id:"动态库的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动态库的使用"}},[s._v("#")]),s._v(" 动态库的使用")]),s._v(" "),n("h3",{attrs:{id:"显式链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#显式链接"}},[s._v("#")]),s._v(" 显式链接")]),s._v(" "),n("p",[s._v("程序员自己负责使动态库执行")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("定义函数指针类型typedef")])]),s._v(" "),n("li",[n("p",[s._v("加载动态库")]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("HMODULE LoadLibrary(\n    LPCTSTR lpFileName\t//动态库文件名或全路径\n);//返回DLL的实例句柄\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("获取函数地址")]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("FARPROC GetProcAddress(\n\tHMODULE hModule,\t//DLL句柄\n    LPCSTR lpProcName\t//函数名称\n);//成功返回函数地址\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("使用函数")])]),s._v(" "),n("li",[n("p",[s._v("卸载动态库")]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("BOOL FreeLibrary(\n\tHMODULE hModule\t//DLL句柄\n);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码"}},[s._v("#")]),s._v(" 代码")]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#include <iostream>\nusing namespace std;\n\n_declspec(dllimport)int CPPDll_add(int add1, int add2);\n_declspec(dllimport)int CPPDll_sub(int sub1, int sub2);\n_declspec(dllimport)int CPPDll_mul(int mul1, int mul2);\n#pragma comment(lib,"../Debug/CPPDll.lib")\n\nint main() {\n\tint sum = CPPDll_add(5, 4);\n\tint sub = CPPDll_sub(5, 4);\n\tint mul = CPPDll_mul(5, 4);\n\tcout << "sum=" << sum << ",sub=" << sub << ",mul=" << mul << endl;\n\treturn 0;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"隐式链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#隐式链接"}},[s._v("#")]),s._v(" 隐式链接")]),s._v(" "),n("p",[s._v("操作系统负责使动态库执行")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("头文件和函数原型")]),s._v(" "),n("p",[s._v("可以在函数原型的声明前，增加"),n("code",[s._v("_declspec(dllimport)")])])]),s._v(" "),n("li",[n("p",[s._v("导入动态库的LIB文件")])]),s._v(" "),n("li",[n("p",[s._v("在程序中使用函数")])]),s._v(" "),n("li",[n("p",[s._v("隐式链接的情况，dll文件可以存放的路径")]),s._v(" "),n("ul",[n("li",[s._v("与执行文件中同一个目录下")]),s._v(" "),n("li",[s._v("当前工作目录")]),s._v(" "),n("li",[s._v("Windows目录")]),s._v(" "),n("li",[s._v("Windows/System32目录")]),s._v(" "),n("li",[s._v("Windows/System目录")]),s._v(" "),n("li",[s._v("环境变量PATH指定目录")])])]),s._v(" "),n("li",[n("p",[s._v("更改CPPDll")])])]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("int CPPDll_add(int add1, int add2) {\n\treturn add1 + add2;\n}\n\nint CPPDll_sub(int sub1, int sub2) {\n\treturn sub1 - sub2;\n}\n\n_declspec(dllexport)int CPPDll_mul(int mul1, int mul2) {\n\treturn mul1 * mul2;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("增模块定义CPPDll.def")])]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LIBRARY CPPDll\nEXPORTS\n\tCPPDll_add @1\n\tCPPDll_sub @2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("隐式链接使用")])]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#include <Windows.h>\n#include <iostream>\nusing namespace std;\n\ntypedef int(*ADD)(int m, int n);\ntypedef int(*SUB)(int m, int n);\ntypedef int(*MUL)(int m, int n);\nint main() {\n\tHINSTANCE hDll = LoadLibrary("../Debug/CPPDll.dll");\n\tcout << "hDll:" << hDll << endl;\n\n\tADD myAdd = (ADD)GetProcAddress(hDll, "CPPDll_add");\n\tcout << "myAdd:" << myAdd << endl;\n\tint sum = myAdd(5, 4);\n\tcout << "sum=" << sum << endl;\n\n\tSUB mySub = (SUB)GetProcAddress(hDll, "CPPDll_sub");\n\tcout << "mySub:" << mySub << endl;\n\tint sub = mySub(5, 4);\n\tcout << "sub=" << sub << endl;\n\n\tMUL myMul = (MUL)GetProcAddress(hDll, "?CPPDll_mul@@YAHHH@Z");\n\tcout << "myMul:" << myMul << endl;\n\tint mul = myMul(5, 4);\n\tcout << "mul=" << mul << endl;\n\t\n\tFreeLibrary(hDll);\n\treturn 0;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("h2",{attrs:{id:"动态库中封装类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动态库中封装类"}},[s._v("#")]),s._v(" 动态库中封装类")]),s._v(" "),n("ul",[n("li",[s._v("在类名称前增加_declspec(dllexport)定义，例如")])]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("class _declspec(dllexport) CMath{\n  ...  \n};\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("通常使用预编译开关切换类的导入导出定义，例如")])]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#ifdef DLLCLASS_EXPORTS\n#define EXT_CLASS _declspec(dllexport)\n#else\n#define EXT_CLASS _declspec(dllimxport)\n#endif\nclass EXT_CLASS CMath{\n    ...\n};\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h4",{attrs:{id:"代码-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码-2"}},[s._v("#")]),s._v(" 代码")]),s._v(" "),n("ul",[n("li",[s._v("新建dll工程")])]),s._v(" "),n("p",[s._v("CPPDllClass.h")]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#ifndef _CPPDLLCLASS_H\n#define _CPPDLLCLASS_H\n\n#ifdef CPPDLLCLASS_EXPORTS\n#define EXT_CLASS _declspec(dllexport)\n#else\n#define EXT_CLASS _declspec(dllimport)\n#endif\n\nclass EXT_CLASS CMath {\npublic:\n\tint Add(int add1, int add2);\n\tint Sub(int sub1, int sub2);\n};\n\n#endif\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("CPPDllClass.cpp")]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#define CPPDLLCLASS_EXPORTS\n#include "CPPClassDll.h"\n\nint CMath::Add(int add1, int add2)\n{\n\treturn add1+ add2;\n}\n\nint CMath::Sub(int sub1, int sub2)\n{\n\treturn sub1 - sub2;\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("新建DLL使用工程")])]),s._v(" "),n("div",{staticClass:"language-C++ line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#include <iostream>\n#include "../CPPCLassDll/CPPClassDll.h"\nusing namespace std;\n\n#pragma comment(lib,"../Debug/CPPClassDll.lib")\nint main() {\n\tCMath math;\n\tint sum = math.Add(5, 6);\n\tint sub = math.Sub(5, 6);\n\tcout << "sum=" << sum << ",sub=" << sub << endl;\n\treturn 0;\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])])}),[],!1,null,null,null);n.default=l.exports}}]);